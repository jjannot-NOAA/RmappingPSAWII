---
title: "Introduction-Basic Mapping"
author: "Kevin Stierhoff"
date: '`r format(Sys.time(), format = "%F")`'
output:
  xaringan::moon_reader:
    css: ["default","css/css-slides.css"]
    lib_dir: libs
    nature:
      ratio: 16:9
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
# Install and load pacman (library management package)
if (!require("pacman")) install.packages("pacman")

# Install and load required packages from CRAN ----
pacman::p_load(xaringan,knitr,tidyverse,here,emo,
               rnaturalearth,rnaturalearthdata,marmap,
               ggmap,ggrepel,shadowtext,cowplot, ggspatial)

options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(message = F, warning = F,
                      fig.align = 'center',
                      fig.dim = c(6.5, 6.1), fig.retina = 2, 
                      out.height = "100%")
knitr::opts_hooks$set(fig.callout = function(options) {
  if (options$fig.callout) {
    options$echo <- FALSE
    options$out.height <- "99%"
    options$fig.width <- 16
    options$fig.height <- 8
  }
  options
})
```

## Outline

+ What makes a map?
+ Let's make a map!
+ Base graphics
+ ggplot2

---

## What is a map?

_**According to Wikipedia:**_

A map is a symbolic depiction emphasizing relationships between elements of some space, such as objects, regions, or themes.  

Many maps are static, fixed to paper or some other durable medium, while others are dynamic or interactive.  

---

## Let's load some spatial data

Load some transect data from a survey of coastal pelagic fishes (CPS) off the west coast of the U.S. and Canada

```{r,echo=T}
# Read data file
cps <- read_csv(here("Data/cps.csv")) %>% 
  select(transect, interval, everything())

# Show first 10 rows
head(cps, 5)
```  

- `transect` and `interval` constitute a unique measurement
- `long` and `lat` are (x,y)
- `nasc` (Nautical Area Scattering Coefficient) ~ "acoustic biomass"

---

## Let's make a map

Create a **VERY** basic map using **base** graphics (`r emo::ji("sick")`)

.left-code[
```{r plot1-code,eval=F}
# Plot lat/long
plot(cps$long, cps$lat)
``` 
]

.right-plot[
```{r plot1-output,ref.label="plot1-code",echo=F}
``` 
]

---

## Let's make a (slightly better) map

The same **VERY** basic map using **ggplot2** (still `r emo::ji("sick")`)

.left-code[
```{r plot2-code,eval=F}
# Plot lat/long
ggplot(cps, aes(long, lat)) +
  geom_point()
```
]

.right-plot[
```{r plot2-output,ref.label="plot2-code",echo=F}
``` 
]

---

## Let's make a (barely acceptable) map

The same **VERY** basic ggplot2 map with some basic ggplot2 tweaks (still `r emo::ji("sick")`)
.left-code[
```{r plot3-code,eval=F}
# Plot lat/long
ggplot(cps, aes(long, lat)) +
  geom_point() +
  # Change axis labels
  xlab("Longitude") + #<<
  ylab("Latitude") +  #<<
  # Use map coords
  coord_map() + #<< 
  # Use b/w theme
  theme_bw()    #<< 
```
]

.right-plot[
```{r plot3-output,ref.label="plot3-code",echo=F}
``` 
]

---

## Let's make a better (barely acceptable) map

The same map with some useful info (`r emo::ji("meh")`)

.left-code[
```{r plot4-code,eval=F}
# Subset locations
locs <- read_csv( #<<
  here("Data/locations.csv")) #<<

# Plot lat/long
ggplot(cps, aes(long, lat)) +
  geom_point() +
  xlab("Longitude") + 
  ylab("Latitude") +
  # Use map coordinates
  coord_map() +
  # Use b/w theme
  theme_bw() +
  # Add locations
  geom_text(data = locs, #<< 
            aes(long, lat, #<<
                label = name)) #<<
```
]

.right-plot[
```{r plot4-output,ref.label="plot4-code",echo=F}
``` 
]

---

## OK, one more (mostly) terrible map

The same map with some place names and an equal area projection (`r emo::ji("meh")`)

.left-code[
```{r plot5-code,eval=F}
# Plot lat/long
ggplot(cps, aes(long, lat)) +
  # Scale points by size
  geom_point(aes(size = nasc)) + #<<
  xlab("Longitude") + 
  ylab("Latitude") +
  coord_map(projection = 'azequalarea') + #<< 
  theme_bw() +
  geom_text(data = #<<
              filter(locs, 
                     group == "state"), #<<
            aes(long, lat, #<<
                label = name),#<<
            hjust = 1)#<<
```
]

.right-plot[
```{r plot5-output,ref.label="plot5-code",echo=F}
``` 
]

---

## Mapping packages using online servers
The [`ggmap`](https://github.com/dkahle/ggmap) package is an excellent package that allows you to quickly create a map without using any land shapefiles.  

The Google Maps API has recently changed their use policies, which has made the Google Maps option a little tricky, but it's manageable.

.left-code[
```{r plot6-code,eval=F}
# Define lat and long range
wc.lat  <- range(cps$lat)
wc.long <- range(cps$long)

# Set west coast boundaries for stamen maps
stamen.bounds <- c(left = min(wc.long), 
                   bottom = min(wc.lat),
                   right = max(wc.long), 
                   top = max(wc.lat))

# Download stamen map of west coast; zoom = 6 seems good
stamen.map <- ggmap(get_stamenmap(
  stamen.bounds, zoom = 6, 
  maptype = "toner-lite")) +
  xlab("Longitude") + ylab("Latitude") +
  theme_bw()

# Plot the map
stamen.map
```
]

.right-plot[
```{r plot6-output,ref.label="plot6-code",echo=F}
``` 
]

---

## Mapping packages using online servers
Add the CPS transects to the stamen map

.left-code[
```{r plot7-code,eval=F}
# Add transects and CPS backscatter
cps.prelim <- stamen.map +
  geom_path(data = cps, #<<
            aes(long, lat, #<<
                group = transect)) + #<<
  geom_point(data = filter(cps, nasc > 0), #<<
             aes(long, lat, size = nasc)) #<<

# Plot map
cps.prelim
```
]

.right-plot[
```{r plot7-output,ref.label="plot7-code",echo=F}
``` 
]

---
## Mapping packages using online servers
Add some frills to the map

.left-code[
```{r plot8-code,eval=F}
# Add some repelled labels
cps.final1 <- cps.prelim +
  geom_text_repel(
    data = filter(locs, group == "city"),
    aes(long, lat, label = name)) +
  theme(legend.position = "none")

# Add some masked labels
cps.final2 <- cps.prelim +
  geom_shadowtext(
    data = filter(locs, group == "city"),
    aes(long, lat, label = name),
    colour = "blue",
    bg.colour = "yellow") +
  theme(legend.position = "none")

# Plot map
cowplot::plot_grid(cps.final1, 
                   cps.final2, 
                   nrow = 1)
```
]

.right-plot[
```{r plot8-output,ref.label="plot8-code",echo=F}
``` 
]

---

## Importing land data (`rnaturalearth`)
Acquiring good land mass information is often a challenge 

`rnaturalearth` is a wonderful package for easily importing land data at a variety of levels (continent, country, state, county) and scales ("low", "medium", "high"; high requires installation of `rnaturalearthhires`)

.left-code[
```{r plot9-code,eval=F}
# Download worldwide countries 
# at medium resolution
world <- ne_countries(
  scale = "medium", 
  returnclass = "sf")

# Plot result
ggplot(data = world) +
  geom_sf() +
  theme_bw()
```
]

.right-plot[
```{r plot9-output,ref.label="plot9-code",echo=F}
``` 
]

---
## Importing land data (`rnaturalearth`)

```{r plot10-code,eval=F}
ggplot(data = world) +
  # Symbolize polygons by continent
  geom_sf(aes(fill = continent)) + #<<
  theme_bw()
```

```{r plot10-output,ref.label="plot10-code",fig.dim = c(9,6),echo=F}
``` 

---
## Download West Coast of the North America

.left-code[
```{r plot11-code,eval=F}
# Download worldwide states 
# and filter for Western N. Am.
states <- ne_states(
  country = c("Canada",
              "United States of America",
              "Mexico"),
  returnclass = 'sf') %>% 
  filter(name %in% c("California","Oregon",
                     "Washington",
                     "British Columbia",
                     "Baja California",
                     "Baja California Sur"))

# Plot result
ggplot(data = states) +
  geom_sf() +
  theme_bw()
```
]

.right-plot[
```{r plot11-output,ref.label="plot11-code",echo=F}
``` 
]

---
## Zoom to the West Coast of the U.S.

```{r}

```

---
## Zoom to the West Coast of the U.S.

```{r}

```

---

## Review of topics covered
- Basic plotting of X,Y data (boring!) using `ggplot2`
- Getting and plotting land feature data
- Getting and plotting bathymetry data
- Creating a base map
- Faceting 
